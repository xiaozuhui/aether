# Aether 大整数支持

## 概述

从此版本开始，Aether 支持任意精度的大整数运算。当整数超过 15 位时，系统会自动使用大整数（BigInt）进行精确计算，避免浮点数精度损失。

## 特性

### 自动检测

Aether 会自动检测大整数并切换到精确计算模式：

- **小整数（≤15位）**：使用高效的浮点数运算（f64）
- **大整数（>15位）**：自动切换到任意精度的 BigInt 运算

### 支持的运算

大整数支持以下运算符：

- **加法（+）**：精确的整数加法
- **减法（-）**：精确的整数减法
- **乘法（*）**：精确的整数乘法
- **除法（/）**：返回精确的分数结果

## 示例

### 基本大数运算

```aether
PRINTLN("大数乘法示例")
Set A 3284628396498263948629734587234583548273548253487325
Set B 4728364875283754872534781253784527635487235478923587423
Set RESULT (A * B)
PRINTLN(RESULT)
// 输出: 15530921538361993565152129229913877304236184424817572492058487603003384389356972658598499493820859259913475
```

### 大数加法

```aether
Set A 999999999999999999999999999999
Set B 1
Set SUM (A + B)
PRINTLN(SUM)
// 输出: 1000000000000000000000000000000
```

### 大数减法

```aether
Set A 1000000000000000000000000000000
Set B 1
Set DIFF (A - B)
PRINTLN(DIFF)
// 输出: 999999999999999999999999999999
```

### 大数除法

```aether
Set A 1000000000000000000000000000000
Set B 2
Set QUOT (A / B)
PRINTLN(QUOT)
// 输出: 500000000000000000000000000000
```

### 混合运算

```aether
Set A 12345678901234567890
Set B 98765432109876543210
Set C (A + B)
Set D (C * 2)
PRINTLN(D)
// 输出: 222222222022222222200
```

## 实现细节

### 内部表示

- 大整数在内部表示为 `Fraction(Ratio<BigInt>)`，即分母为 1 的分数
- 这允许无缝集成到现有的分数运算系统中
- 结果始终是精确的，不会有舍入误差

### 性能考虑

- 小整数（≤15位）仍然使用快速的浮点运算
- 只有大整数才会触发 BigInt 计算，确保性能不受影响
- BigInt 运算虽然比浮点数慢，但保证了精确性

### 与现有功能的兼容性

- 大整数可以与普通数字混合运算
- 与 `TO_FRACTION`、`FRAC_*` 等分数函数完全兼容
- 可以使用 `TO_FLOAT` 将大整数转换为浮点数（可能损失精度）

## 限制

1. **仅支持整数**：大整数只用于整数运算，浮点数仍使用 f64
2. **内存限制**：极大的数字可能消耗大量内存
3. **性能**：BigInt 运算比浮点数慢，但保证精确

## 测试示例

运行以下命令测试大整数功能：

```bash
cargo run --release test_bignum.aether
cargo run --release test_bignum_comprehensive.aether
cargo test --release --test bigint_tests
```

## 与其他语言对比

### Python

```python
>>> 3284628396498263948629734587234583548273548253487325 * 4728364875283754872534781253784527635487235478923587423
15530921538361993565152129229913877304236184424817572492058487603003384389356972658598499493820859259913475
```

### Common Lisp

```lisp
(* 3284628396498263948629734587234583548273548253487325 4728364875283754872534781253784527635487235478923587423)
; => 15530921538361993565152129229913877304236184424817572492058487603003384389356972658598499493820859259913475
```

### Aether

```aether
Set A 3284628396498263948629734587234583548273548253487325
Set B 4728364875283754872534781253784527635487235478923587423
Set RESULT (A * B)
PRINTLN(RESULT)
// 输出: 15530921538361993565152129229913877304236184424817572492058487603003384389356972658598499493820859259913475
```

Aether 现在与 Python 和 Common Lisp 一样，提供了开箱即用的大整数支持！

## 未来计划

- [ ] 优化大整数性能
- [ ] 添加位运算支持
- [ ] 支持科学计数法的大数输入
- [ ] 提供配置选项来调整大整数阈值
